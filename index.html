<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <script src="./Heir/heir.js"></script>
        <script src="./EventEmitter/EventEmitter.min.js"></script>
        <script src="./engine.js"></script>
        <script>
            var eng;
            var rotateSpeed = 0.05, moveSpeed = 4;
            var fps = 30;
            var globalSpeed = 60 / fps;
            function randInt(from, to)
            {
                return Math.floor(Math.random() * (to - from)) + from;
            }
            var keyPresses = {
                left: false,
                right: false,
                up: false,
                down: false
            };
            window.addEventListener("load", function() {
                eng = new UDEngine(document.getElementById("container"));
                function setCameraOnClick()
                {
                    var x = parseInt(document.getElementById("xval").value);
                    var y = parseInt(document.getElementById("yval").value);
                    var angle = parseFloat(document.getElementById("angle").value) * ( Math.PI / 180);
                    eng.camera.position = {
                        x: x,
                        y: y
                    };
                    eng.camera.direction = angle;
                }
                document.getElementById("setbutton").addEventListener("click", setCameraOnClick);
                document.getElementById("updatebutton").addEventListener("click", function() {
                    setCameraOnClick();
                    eng.update();
                });
                document.addEventListener("keydown", function(event) {
                    switch(event.keyCode)
                    {
                        case 37:
                            keyPresses.left = true;
                            break;
                        case 39:
                            keyPresses.right = true;
                            break;
                        case 38:
                            keyPresses.up = true;
                            break;
                        case 40:
                            keyPresses.down = true;
                            break;
                    }
                });
                document.addEventListener("keyup", function(event) {
                    switch(event.keyCode)
                    {
                        case 37:
                            keyPresses.left = false;
                            break;
                        case 39:
                            keyPresses.right = false;
                            break;
                        case 38:
                            keyPresses.up = false;
                            break;
                        case 40:
                            keyPresses.down = false;
                            break;
                    }
                });
                window.setInterval(function() {
                    //eng.camera.direction += 0.02;
                    if(keyPresses.left)
                    {
                        eng.camera.direction -= rotateSpeed * globalSpeed;
                    }
                    if(keyPresses.right)
                    {
                        eng.camera.direction += rotateSpeed * globalSpeed;
                    }
                    if(keyPresses.up)
                    {
                        eng.camera.position.x += Math.cos(eng.camera.direction) * moveSpeed * globalSpeed;
                        eng.camera.position.y += Math.sin(eng.camera.direction) * moveSpeed * globalSpeed;
                    }
                    if(keyPresses.down)
                    {
                        eng.camera.position.x -= Math.cos(eng.camera.direction) * moveSpeed * globalSpeed;
                        eng.camera.position.y -= Math.sin(eng.camera.direction) * moveSpeed * globalSpeed;
                    }
                    eng.update();
                }, 1000 / fps);
                var worldWidth = 256, worldHeight = 256;
                eng.setSize(512, 512);
                for(var i = 0; i < 64; i++)
                {
                    var color = new UDColor(randInt(0, 256), randInt(0, 256), randInt(0, 256));
                    var atom = new UDAtom(randInt(0, worldWidth), randInt(0, worldHeight), color);
                    eng.tree.addItem(atom);
                }
                eng.tree.split();
                eng.update();
            });
        </script>
        <style>
            body {
                margin: auto;
            }
            canvas {
                margin: 10px;
                outline-style: solid;
                outline-color: black;
                outline-width: 1px;
            }
        </style>
    </head>
    <body>
        <div>
            <input type="text" value="0" id="xval">
            <input type="text" value="0" id="yval">
            <input type="text" value="0" id="angle">
            <input type="button" value="set" id="setbutton">
            <input type="button" value="update" id="updatebutton">
        </div>
        <div id="container"></div>
    </body>
</html>